name       : grub2
version    : '2.04'
release    : 28
source     :
    - git|https://git.savannah.gnu.org/git/grub.git : e7b8856f8be3292afdb38d2e8c70ad8d62a61e10
homepage   : https://www.gnu.org/software/grub/
license    : GPL-3.0-or-later
component  : system.boot
networking : yes # Needed for bootstrap
summary    : GRUB Boot Loader
description: |
    GRUB Boot Loader
builddeps  :
    - pkgconfig(devmapper)
    - pkgconfig(freetype2)
    - pkgconfig(liblz4)
    - pkgconfig(liblzma)
strip      : no
rundeps    :
    - os-prober
environment: |
    unset CFLAGS
    unset LDFLAGS
    unset CXXFLAGS
setup      : |
    %patch -p1 < $pkgfiles/brand.patch
    %patch -p1 < $pkgfiles/0001-Fix-default-gnulib-url.patch
    ./bootstrap
    %autogen --disable-werror \
               --enable-device-mapper \
               --disable-efiemu \
               --with-platform="pc" \
               --target="i386"
build      : |
    %make
install    : |
    %make_install
    install -Dm00755 $pkgfiles/update-grub $installdir/usr/sbin/update-grub
    install -Dm00755 $pkgfiles/update-grub2 $installdir/usr/sbin/update-grub2
    install -Dm00644 $pkgfiles/conf/grub $installdir/etc/default/grub
    install -Dm00644 $pkgfiles/splash.tga $installdir/usr/share/backgrounds/splash.tga
    install -Dm00644 $pkgfiles/unicode.pf2 $installdir/usr/share/grub/unicode.pf2
    rm $installdir/etc/grub.d/30_uefi-firmware
